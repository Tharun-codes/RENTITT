<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - RENTit</title>
  <link rel="stylesheet" href="./style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="login-container">
  <div class="login-wrapper">
    <!-- Logo/Brand -->
    <div class="login-header">
      <a href="index.html" class="logo logo-lg">RENTit</a>
      <p>Welcome back! Sign in to continue</p>
    </div>

    <!-- Login Card -->
    <div class="login-card">
      <h2>Login / Register</h2>

      <form onsubmit="event.preventDefault(); login();" class="login-form">
        <div class="form-group">
          <label for="emailInput" class="form-label">
            Email Address
          </label>
          <input id="emailInput"
                 type="email"
                 placeholder="Enter your email"
                 required
                 class="form-input">
        </div>

        <button type="submit" id="loginButton" class="btn btn-primary btn-full">
          Continue
        </button>
      </form>

      <p id="msg" class="form-message"></p>

      <div class="login-footer">
        <p>
          Don't have an account? No problem! Enter your email to get started.
        </p>
      </div>
    </div>

    <!-- Back to Home -->
    <div class="back-link">
      <a href="index.html">← Back to Home</a>
    </div>
  </div>

<script>
async function login() {
  const email = document.getElementById("emailInput").value;
  const msg = document.getElementById("msg");
  const loginButton = document.getElementById("loginButton");
  const originalText = loginButton.textContent;

  if (!email) {
    msg.textContent = "Please enter your email address";
    msg.className = "form-message message-error";
    return;
  }

  // Disable button and show loading
  loginButton.disabled = true;
  loginButton.innerHTML = '<span class="loading"></span> Signing in...';
  msg.textContent = "";
  msg.className = "form-message";

  try {
    const res = await fetch("http://localhost:5000/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    let data;
    try {
      data = await res.json();
    } catch (parseError) {
      // If response is not JSON, use status text
      throw new Error(res.statusText || "Server error");
    }

    if (!res.ok) {
      msg.textContent = data.error || data.message || `Error: ${res.status} ${res.statusText}`;
      msg.className = "form-message message-error";
      loginButton.disabled = false;
      loginButton.textContent = originalText;
      return;
    }

    if (!data.token) {
      msg.textContent = "Invalid response from server. Please try again.";
      msg.className = "form-message message-error";
      loginButton.disabled = false;
      loginButton.textContent = originalText;
      return;
    }

    localStorage.setItem("token", data.token);

    msg.textContent = "Login Successful! Redirecting...";
    msg.className = "form-message message-success";
    loginButton.textContent = "✓ Success";

    setTimeout(() => {
      window.location.href = "index.html";
    }, 1000);

  } catch (err) {
    console.error("Login error:", err);
    msg.textContent = err.message || "Unable to connect to server. Please check if the server is running.";
    msg.className = "form-message message-error";
    loginButton.disabled = false;
    loginButton.textContent = originalText;
  }
}
</script>

</body>
</html>
